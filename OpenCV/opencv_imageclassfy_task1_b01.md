<!-- Path: General_python/openCV/å½±åƒè¾¨è­˜-å‚³çµ±æ–¹æ³• | Timestamp: 2025-10-06 16:00:00 | Version: b01 -->
# é¡Œç›®ä¸€ï¼šäººè‡‰è¨ˆæ•¸èˆ‡æ¡†é¸æ‡‰ç”¨

## ğŸ“‹ ä»»å‹™èªªæ˜

è«‹æ’°å¯«ä¸€å€‹ Python ç¨‹å¼ï¼Œèƒ½å¤ è‡ªå‹•åµæ¸¬ç…§ç‰‡ä¸­çš„äººè‡‰æ•¸é‡ï¼Œä¸¦åœ¨æ¯å¼µäººè‡‰ä¸Šæ–¹é¡¯ç¤ºç·¨è™Ÿæ¨™ç±¤ï¼ˆä¾‹å¦‚ï¼šã€Œäººè‡‰ 1ã€ã€ã€Œäººè‡‰ 2ã€...ï¼‰ã€‚

---

## ğŸ–¼ï¸ å½±åƒé¸æ“‡æŒ‡å¼•

### é©åˆçš„å½±åƒé¡å‹

#### âœ… æ¨è–¦ä½¿ç”¨çš„å½±åƒ
1. **æ­£é¢äººè‡‰ç…§ç‰‡**
   - ç‰¹å¾µï¼šè‡‰éƒ¨å®Œæ•´æœå‘é¡é ­ï¼Œäº”å®˜æ¸…æ™°å¯è¦‹
   - ç¯„ä¾‹ï¼šè­‰ä»¶ç…§ã€è‡ªæ‹ç…§ã€åœ˜é«”ç…§
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼ˆ95%+ï¼‰

2. **å…‰ç·šå……è¶³çš„ç…§ç‰‡**
   - ç‰¹å¾µï¼šæ˜äº®å‡å‹»çš„å…‰ç·šï¼Œç„¡å¼·çƒˆé™°å½±
   - æ‹æ”ç’°å¢ƒï¼šç™½å¤©å®¤å…§ã€æˆ¶å¤–é™°å½±è™•ã€æŸ”å’Œç‡ˆå…‰ä¸‹
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼ˆ90%+ï¼‰

3. **ä¸­è¿‘è·é›¢æ‹æ”**
   - ç‰¹å¾µï¼šäººè‡‰åœ¨ç•«é¢ä¸­ä½”æ¯”é©ä¸­ï¼ˆè‡³å°‘ 50Ã—50 åƒç´ ï¼‰
   - è·é›¢ï¼š1-3 å…¬å°ºå…§æ‹æ”
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜…â˜…â˜†ï¼ˆ85%+ï¼‰

4. **å–®ä¸€æˆ–å¤šäººæ¸…æ™°ç…§ç‰‡**
   - ç‰¹å¾µï¼šæ¯å¼µè‡‰éƒ½æ¸…æ™°ã€ä¸é‡ç–Š
   - ç¯„ä¾‹ï¼šå…¨å®¶ç¦ã€ç•¢æ¥­ç…§ã€æœƒè­°åˆç…§
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜…â˜…â˜†ï¼ˆ80%+ï¼‰

#### âš ï¸ æ•ˆæœè¼ƒå·®çš„å½±åƒ
1. **å´è‡‰æˆ–ä½é ­ç…§ç‰‡**
   - å•é¡Œï¼šHaar Cascade ä¸»è¦è¨“ç·´æ–¼æ­£é¢äººè‡‰
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜†â˜†â˜†ï¼ˆ30-50%ï¼‰
   - æ”¹å–„æ–¹æ³•ï¼šä½¿ç”¨æ·±åº¦å­¸ç¿’æ¨¡å‹ï¼ˆå¦‚ MTCNNï¼‰

2. **é€†å…‰æˆ–éæš—ç…§ç‰‡**
   - å•é¡Œï¼šè‡‰éƒ¨ç‰¹å¾µä¸æ¸…æ™°
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜†â˜†â˜†ï¼ˆ40-60%ï¼‰
   - æ”¹å–„æ–¹æ³•ï¼šèª¿æ•´åœ–ç‰‡äº®åº¦æˆ–å°æ¯”åº¦

3. **äººè‡‰éå°çš„ç…§ç‰‡**
   - å•é¡Œï¼šäººè‡‰åƒç´ å°‘æ–¼ 30Ã—30
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼ˆ10-30%ï¼‰
   - æ”¹å–„æ–¹æ³•ï¼šé™ä½ `minSize` åƒæ•¸æˆ–è£åˆ‡æ”¾å¤§

4. **æ¨¡ç³Šæˆ–å‹•æ…‹ç…§ç‰‡**
   - å•é¡Œï¼šäº”å®˜è¼ªå»“ä¸æ¸…æ™°
   - åµæ¸¬æˆåŠŸç‡ï¼šâ˜…â˜…â˜†â˜†â˜†ï¼ˆ30-50%ï¼‰
   - æ”¹å–„æ–¹æ³•ï¼šä½¿ç”¨æ¸…æ™°çš„éœæ…‹ç…§ç‰‡

#### âŒ ä¸é©åˆçš„å½±åƒ
- ç´”å´é¢ç…§ï¼ˆè‡‰éƒ¨è§’åº¦ > 45Â°ï¼‰
- æˆ´å£ç½©ã€å¢¨é¡ç­‰å¤§é¢ç©é®æ“‹
- å¡é€šæˆ–ç¹ªç•«äººè‡‰ï¼ˆéçœŸå¯¦äººè‡‰ï¼‰
- æ¥µç«¯å…‰ç·šï¼ˆå…¨é»‘ã€å¼·å…‰éæ›ï¼‰

### æ¸¬è©¦å½±åƒå»ºè­°

#### åˆå­¸è€…æ¸¬è©¦ï¼ˆé›£åº¦ï¼šâ˜…â˜†â˜†â˜†â˜†ï¼‰
```
å»ºè­°å½±åƒï¼š
- girl.jpgï¼ˆæ•™å­¸ç¯„ä¾‹ï¼‰
- mona.jpgï¼ˆè’™å¨œéº—èï¼‰
- è‡ªå·±çš„è­‰ä»¶ç…§æˆ–è‡ªæ‹ç…§

ç‰¹é»ï¼šå–®äººã€æ­£é¢ã€å…‰ç·šè‰¯å¥½
é æœŸçµæœï¼š100% åµæ¸¬æˆåŠŸ
```

#### ä¸­ç´šæ¸¬è©¦ï¼ˆé›£åº¦ï¼šâ˜…â˜…â˜…â˜†â˜†ï¼‰
```
å»ºè­°å½±åƒï¼š
- 2-4 äººçš„åœ˜é«”ç…§
- å…¨å®¶ç¦ç…§ç‰‡
- æœ‹å‹èšæœƒç…§ç‰‡

ç‰¹é»ï¼šå¤šäººã€æ­£é¢ç‚ºä¸»ã€éƒ¨åˆ†å´è‡‰
é æœŸçµæœï¼š80-90% åµæ¸¬æˆåŠŸ
```

#### é€²éšæ¸¬è©¦ï¼ˆé›£åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†ï¼‰
```
å»ºè­°å½±åƒï¼š
- å¤§å‹åœ˜é«”ç…§ï¼ˆ10 äººä»¥ä¸Šï¼‰
- åŒ…å«ä¸åŒè§’åº¦çš„äººè‡‰
- æœ‰éƒ¨åˆ†é®æ“‹æˆ–å…‰ç·šä¸å‡

ç‰¹é»ï¼šè¤‡é›œå ´æ™¯ã€å¤šç¨®è§’åº¦
é æœŸçµæœï¼š60-80% åµæ¸¬æˆåŠŸ
```

### å½±åƒæº–å‚™æª¢æŸ¥æ¸…å–®

åœ¨æ¸¬è©¦å‰ï¼Œè«‹ç¢ºèªä½ çš„å½±åƒï¼š
- [ ] æ ¼å¼ç‚º JPGã€PNG ç­‰å¸¸è¦‹åœ–ç‰‡æ ¼å¼
- [ ] è§£æåº¦è‡³å°‘ 640Ã—480ï¼ˆå»ºè­° 1024Ã—768 ä»¥ä¸Šï¼‰
- [ ] æª”æ¡ˆå¤§å°ä¸è¶…é 5MBï¼ˆé¿å…è¨˜æ†¶é«”å•é¡Œï¼‰
- [ ] äººè‡‰æ¸…æ™°å¯è¦‹ï¼Œç„¡åš´é‡æ¨¡ç³Š
- [ ] å…‰ç·šé©ä¸­ï¼Œéæ¥µç«¯æ˜æš—
- [ ] äººè‡‰å¤§å°è‡³å°‘ 50Ã—50 åƒç´ 

---

## âœ… è©³ç´°éœ€æ±‚åˆ—è¡¨

### éœ€æ±‚ 1ï¼šç’°å¢ƒæº–å‚™èˆ‡æª”æ¡ˆä¸‹è¼‰

**èªªæ˜**ï¼šåœ¨ Google Colab ç’°å¢ƒä¸­ä¸‹è¼‰æ‰€éœ€çš„æ¨¡å‹æª”æ¡ˆå’Œæ¸¬è©¦åœ–ç‰‡ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# åœ¨ Colab ç¬¬ä¸€å€‹å„²å­˜æ ¼åŸ·è¡Œ
import urllib.request
import os

# ä¸‹è¼‰å¿…è¦æª”æ¡ˆ
files = {
    'haarcascade_frontalface_default.xml': 'https://raw.githubusercontent.com/opencv/opencv/4.x/data/haarcascades/haarcascade_frontalface_default.xml',
    'mona.jpg': 'https://steam.oxxostudio.tw/down/python/ai/mona.jpg',
    'girl.jpg': 'https://steam.oxxostudio.tw/down/python/ai/girl.jpg'
}

for filename, url in files.items():
    if not os.path.exists(filename):
        print(f"ä¸‹è¼‰ {filename}...")
        urllib.request.urlretrieve(url, filename)
        print(f"âœ“ {filename} ä¸‹è¼‰å®Œæˆ")
    else:
        print(f"âœ“ {filename} å·²å­˜åœ¨")

print("\næ‰€æœ‰æª”æ¡ˆæº–å‚™å®Œæˆï¼")
```

---

### éœ€æ±‚ 2ï¼šåŒ¯å…¥å¿…è¦å¥—ä»¶

**èªªæ˜**ï¼šåŒ¯å…¥ OpenCVã€NumPy å’Œ Colab é¡¯ç¤ºå·¥å…·ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# åŒ¯å…¥å¿…è¦çš„å¥—ä»¶
import cv2
import numpy as np
from google.colab.patches import cv2_imshow

print("âœ“ å¥—ä»¶åŒ¯å…¥å®Œæˆ")
```

---

### éœ€æ±‚ 3ï¼šè®€å–ä¸¦æª¢æŸ¥åœ–ç‰‡

**èªªæ˜**ï¼šè®€å–åœ–ç‰‡æª”æ¡ˆï¼Œä¸¦æª¢æŸ¥æ˜¯å¦æˆåŠŸè®€å–ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# è®€å–åœ–ç‰‡
img = cv2.imread('girl.jpg')  # æˆ–ä½¿ç”¨å…¶ä»–åŒ…å«äººè‡‰çš„åœ–ç‰‡

# æª¢æŸ¥åœ–ç‰‡æ˜¯å¦æˆåŠŸè®€å–
if img is None:
    print("éŒ¯èª¤: ç„¡æ³•è®€å–åœ–ç‰‡ï¼Œè«‹ç¢ºèªæª”æ¡ˆå·²æ­£ç¢ºä¸‹è¼‰")
    print("è«‹æª¢æŸ¥ï¼š")
    print("1. æª”æ¡ˆæ˜¯å¦å­˜åœ¨æ–¼ç•¶å‰ç›®éŒ„")
    print("2. æª”æ¡ˆåç¨±æ˜¯å¦æ­£ç¢º")
else:
    print("âœ“ åœ–ç‰‡è®€å–æˆåŠŸ")
    # é¡¯ç¤ºåœ–ç‰‡å°ºå¯¸
    height, width, channels = img.shape
    print(f"åœ–ç‰‡å°ºå¯¸: {width} x {height} åƒç´ ")
    print(f"è‰²å½©é€šé“: {channels}")
```

---

### éœ€æ±‚ 4ï¼šè½‰æ›ç‚ºç°éšå½±åƒ

**èªªæ˜**ï¼šå°‡å½©è‰²åœ–ç‰‡è½‰æ›ç‚ºç°éšï¼Œä»¥æé«˜åµæ¸¬æ•ˆç‡ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# å°‡åœ–ç‰‡è½‰æ›ç‚ºç°éš
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
print("âœ“ åœ–ç‰‡å·²è½‰æ›ç‚ºç°éš")
```

---

### éœ€æ±‚ 5ï¼šè¼‰å…¥ Haar Cascade äººè‡‰åµæ¸¬æ¨¡å‹

**èªªæ˜**ï¼šè¼‰å…¥é è¨“ç·´çš„äººè‡‰åµæ¸¬æ¨¡å‹ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# è¼‰å…¥äººè‡‰åµæ¸¬æ¨¡å‹
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')

# æª¢æŸ¥æ¨¡å‹æ˜¯å¦æˆåŠŸè¼‰å…¥
if face_cascade.empty():
    print("éŒ¯èª¤: ç„¡æ³•è¼‰å…¥äººè‡‰åµæ¸¬æ¨¡å‹")
    print("è«‹ç¢ºèª haarcascade_frontalface_default.xml æª”æ¡ˆå­˜åœ¨")
else:
    print("âœ“ äººè‡‰åµæ¸¬æ¨¡å‹è¼‰å…¥æˆåŠŸ")
```

---

### éœ€æ±‚ 6ï¼šåŸ·è¡Œäººè‡‰åµæ¸¬

**èªªæ˜**ï¼šä½¿ç”¨ `detectMultiScale()` æ–¹æ³•åµæ¸¬åœ–ç‰‡ä¸­çš„æ‰€æœ‰äººè‡‰ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# åµæ¸¬äººè‡‰
# scaleFactor: å½±åƒç¸®æ”¾æ¯”ä¾‹ï¼Œ1.1 è¡¨ç¤ºæ¯æ¬¡ç¸®å° 10%
# minNeighbors: æ§‹æˆæœ‰æ•ˆåµæ¸¬æ‰€éœ€çš„æœ€å°‘é„°å±…æ•¸é‡
# minSize: æœ€å°äººè‡‰å°ºå¯¸
faces = face_cascade.detectMultiScale(
    gray,                # è¼¸å…¥çš„ç°éšåœ–ç‰‡
    scaleFactor=1.1,     # å»ºè­°å€¼ï¼š1.05-1.3
    minNeighbors=5,      # å»ºè­°å€¼ï¼š3-8
    minSize=(30, 30)     # æœ€å°äººè‡‰å°ºå¯¸ï¼Œé¿å…åµæ¸¬éå°çš„å€åŸŸ
)

# é¡¯ç¤ºåµæ¸¬çµæœ
print(f"âœ“ åµæ¸¬å®Œæˆ")
print(f"æ‰¾åˆ° {len(faces)} å¼µäººè‡‰")

# è‹¥æ²’æœ‰åµæ¸¬åˆ°äººè‡‰
if len(faces) == 0:
    print("\nâš ï¸ æœªåµæ¸¬åˆ°äººè‡‰ï¼Œå¯èƒ½åŸå› ï¼š")
    print("1. åœ–ç‰‡ä¸­æ²’æœ‰æ­£é¢äººè‡‰")
    print("2. äººè‡‰éå°æˆ–éå¤§")
    print("3. å…‰ç·šæ¢ä»¶ä¸ä½³")
    print("4. å»ºè­°èª¿æ•´ scaleFactor æˆ– minNeighbors åƒæ•¸")
```

---

### éœ€æ±‚ 7ï¼šåœ¨æ¯å¼µäººè‡‰ä¸Šç¹ªè£½çŸ©å½¢æ¡†èˆ‡ç·¨è™Ÿ

**èªªæ˜**ï¼šéæ­·æ‰€æœ‰åµæ¸¬åˆ°çš„äººè‡‰ï¼Œç¹ªè£½æ¡†ç·šä¸¦åŠ ä¸Šç·¨è™Ÿæ¨™ç±¤ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# éæ­·æ‰€æœ‰åµæ¸¬åˆ°çš„äººè‡‰
for i, (x, y, w, h) in enumerate(faces, start=1):
    # ç¹ªè£½çŸ©å½¢æ¡†
    # åƒæ•¸ï¼šåœ–ç‰‡, å·¦ä¸Šè§’åº§æ¨™, å³ä¸‹è§’åº§æ¨™, é¡è‰² (BGR), ç·šæ¢ç²—ç´°
    cv2.rectangle(img, (x, y), (x+w, y+h), (0, 255, 0), 2)

    # æº–å‚™æ–‡å­—æ¨™ç±¤
    label = f"äººè‡‰ {i}"

    # è¨ˆç®—æ–‡å­—ä½ç½®ï¼ˆçŸ©å½¢æ¡†ä¸Šæ–¹ï¼‰
    text_x = x
    text_y = y - 10 if y - 10 > 10 else y + h + 20  # é¿å…è¶…å‡ºåœ–ç‰‡ç¯„åœ

    # ç¹ªè£½æ–‡å­—
    cv2.putText(
        img,                              # ç›®æ¨™åœ–ç‰‡
        label,                            # æ–‡å­—å…§å®¹
        (text_x, text_y),                # æ–‡å­—ä½ç½®ï¼ˆå·¦ä¸‹è§’ï¼‰
        cv2.FONT_HERSHEY_SIMPLEX,        # å­—é«”é¡å‹
        0.9,                              # å­—é«”å¤§å°
        (0, 255, 0),                      # æ–‡å­—é¡è‰²ï¼ˆç¶ è‰²ï¼‰
        2                                 # æ–‡å­—ç²—ç´°
    )

    # è¼¸å‡ºæ¯å¼µäººè‡‰çš„åº§æ¨™è³‡è¨Š
    print(f"äººè‡‰ {i}: ä½ç½®({x}, {y}), å¤§å°({w}x{h})")
```

---

### éœ€æ±‚ 8ï¼šçµ±è¨ˆä¸¦é¡¯ç¤ºç¸½äººæ•¸

**èªªæ˜**ï¼šåœ¨çµ‚ç«¯æ©Ÿè¼¸å‡ºç¸½äººæ•¸ï¼Œä¸¦åœ¨åœ–ç‰‡å·¦ä¸Šè§’é¡¯ç¤ºçµ±è¨ˆè³‡è¨Šã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# åœ¨çµ‚ç«¯æ©Ÿè¼¸å‡ºç¸½äººæ•¸
total_faces = len(faces)
print(f"\n{'='*40}")
print(f"åµæ¸¬çµæœçµ±è¨ˆ")
print(f"{'='*40}")
print(f"ç¸½å…±åµæ¸¬åˆ° {total_faces} å¼µäººè‡‰")
print(f"{'='*40}\n")

# å¯é¸ï¼šåœ¨åœ–ç‰‡å·¦ä¸Šè§’é¡¯ç¤ºç¸½äººæ•¸
summary_text = f"Total: {total_faces} face(s)"
cv2.putText(
    img,
    summary_text,
    (10, 30),                        # å·¦ä¸Šè§’ä½ç½®
    cv2.FONT_HERSHEY_SIMPLEX,
    1.0,                              # è¼ƒå¤§çš„å­—é«”
    (255, 0, 0),                      # è—è‰²
    2
)
```

---

### éœ€æ±‚ 9ï¼šé¡¯ç¤ºè™•ç†å¾Œçš„çµæœ

**èªªæ˜**ï¼šä½¿ç”¨ `cv2_imshow()` é¡¯ç¤ºæ¨™è¨˜å¾Œçš„åœ–ç‰‡ã€‚

**ç¨‹å¼ç¢¼æç¤º**ï¼š
```python
# é¡¯ç¤ºè™•ç†å¾Œçš„åœ–ç‰‡
print("è™•ç†å¾Œçš„åœ–ç‰‡ï¼š")
cv2_imshow(img)

# å¯é¸ï¼šå„²å­˜çµæœåœ–ç‰‡
output_filename = 'result_face_count.jpg'
cv2.imwrite(output_filename, img)
print(f"\nâœ“ çµæœå·²å„²å­˜ç‚º {output_filename}")
```

---

## ğŸ“ å®Œæ•´å¯åŸ·è¡Œç¨‹å¼ç¢¼

```python
# ========================================
# é¡Œç›®ä¸€ï¼šäººè‡‰è¨ˆæ•¸èˆ‡æ¡†é¸æ‡‰ç”¨
# ========================================

import cv2
import numpy as np
from google.colab.patches import cv2_imshow

# 1. è®€å–åœ–ç‰‡
img = cv2.imread('girl.jpg')

if img is None:
    print("éŒ¯èª¤: ç„¡æ³•è®€å–åœ–ç‰‡")
else:
    print("âœ“ åœ–ç‰‡è®€å–æˆåŠŸ")
    height, width, channels = img.shape
    print(f"åœ–ç‰‡å°ºå¯¸: {width} x {height} åƒç´ ")

    # 2. è½‰æ›ç‚ºç°éš
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    print("âœ“ åœ–ç‰‡å·²è½‰æ›ç‚ºç°éš")

    # 3. è¼‰å…¥äººè‡‰åµæ¸¬æ¨¡å‹
    face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')

    if face_cascade.empty():
        print("éŒ¯èª¤: ç„¡æ³•è¼‰å…¥äººè‡‰åµæ¸¬æ¨¡å‹")
    else:
        print("âœ“ äººè‡‰åµæ¸¬æ¨¡å‹è¼‰å…¥æˆåŠŸ")

        # 4. åµæ¸¬äººè‡‰
        faces = face_cascade.detectMultiScale(
            gray,
            scaleFactor=1.1,
            minNeighbors=5,
            minSize=(30, 30)
        )

        print(f"âœ“ åµæ¸¬å®Œæˆï¼Œæ‰¾åˆ° {len(faces)} å¼µäººè‡‰")

        # 5. ç¹ªè£½çŸ©å½¢æ¡†èˆ‡ç·¨è™Ÿ
        for i, (x, y, w, h) in enumerate(faces, start=1):
            # ç¹ªè£½çŸ©å½¢æ¡†
            cv2.rectangle(img, (x, y), (x+w, y+h), (0, 255, 0), 2)

            # æº–å‚™æ¨™ç±¤
            label = f"äººè‡‰ {i}"

            # è¨ˆç®—æ–‡å­—ä½ç½®
            text_x = x
            text_y = y - 10 if y - 10 > 10 else y + h + 20

            # ç¹ªè£½æ–‡å­—
            cv2.putText(
                img,
                label,
                (text_x, text_y),
                cv2.FONT_HERSHEY_SIMPLEX,
                0.9,
                (0, 255, 0),
                2
            )

            print(f"äººè‡‰ {i}: ä½ç½®({x}, {y}), å¤§å°({w}x{h})")

        # 6. é¡¯ç¤ºç¸½äººæ•¸çµ±è¨ˆ
        total_faces = len(faces)
        print(f"\n{'='*40}")
        print(f"ç¸½å…±åµæ¸¬åˆ° {total_faces} å¼µäººè‡‰")
        print(f"{'='*40}\n")

        # åœ¨åœ–ç‰‡ä¸Šé¡¯ç¤ºçµ±è¨ˆ
        summary_text = f"Total: {total_faces} face(s)"
        cv2.putText(
            img,
            summary_text,
            (10, 30),
            cv2.FONT_HERSHEY_SIMPLEX,
            1.0,
            (255, 0, 0),
            2
        )

        # 7. é¡¯ç¤ºçµæœ
        print("è™•ç†å¾Œçš„åœ–ç‰‡ï¼š")
        cv2_imshow(img)

        # å„²å­˜çµæœ
        cv2.imwrite('result_face_count.jpg', img)
        print("\nâœ“ çµæœå·²å„²å­˜ç‚º result_face_count.jpg")
```

---

## ğŸ¯ æ¸¬è©¦å»ºè­°

### åŸºæœ¬æ¸¬è©¦æµç¨‹

1. **å–®äººç…§ç‰‡æ¸¬è©¦**
   ```python
   img = cv2.imread('girl.jpg')  # ä½¿ç”¨æ•™å­¸ç¯„ä¾‹
   ```
   - é æœŸçµæœï¼šåµæ¸¬åˆ° 1 å¼µäººè‡‰
   - æª¢æŸ¥ï¼šæ¡†ç·šæ˜¯å¦æº–ç¢ºã€æ¨™ç±¤æ˜¯å¦é¡¯ç¤º

2. **å¤šäººç…§ç‰‡æ¸¬è©¦**
   ```python
   # ä¸Šå‚³ä½ è‡ªå·±çš„åœ˜é«”ç…§
   from google.colab import files
   uploaded = files.upload()
   img = cv2.imread('your_photo.jpg')
   ```
   - é æœŸçµæœï¼šåµæ¸¬åˆ°å¤§éƒ¨åˆ†æ­£é¢äººè‡‰
   - æª¢æŸ¥ï¼šæ˜¯å¦æœ‰æ¼åµæ¸¬æˆ–èª¤åˆ¤

### åƒæ•¸èª¿æ•´å¯¦é©—

**å¯¦é©— 1ï¼šèª¿æ•´ scaleFactor**
```python
# æ¸¬è©¦ä¸åŒçš„ scaleFactor å€¼
scale_factors = [1.05, 1.1, 1.2, 1.3]

for sf in scale_factors:
    faces = face_cascade.detectMultiScale(gray, scaleFactor=sf, minNeighbors=5)
    print(f"scaleFactor={sf}: åµæ¸¬åˆ° {len(faces)} å¼µäººè‡‰")
```

**å¯¦é©— 2ï¼šèª¿æ•´ minNeighbors**
```python
# æ¸¬è©¦ä¸åŒçš„ minNeighbors å€¼
min_neighbors = [3, 5, 7, 10]

for mn in min_neighbors:
    faces = face_cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=mn)
    print(f"minNeighbors={mn}: åµæ¸¬åˆ° {len(faces)} å¼µäººè‡‰")
```

### æ•ˆæœè©•ä¼°

è¨˜éŒ„æ¸¬è©¦çµæœï¼š
- ä½¿ç”¨åœ–ç‰‡ï¼š__________
- å¯¦éš›äººè‡‰æ•¸é‡ï¼š__________
- åµæ¸¬åˆ°çš„æ•¸é‡ï¼š__________
- æº–ç¢ºç‡ï¼š__________ %
- æœ€ä½³åƒæ•¸çµ„åˆï¼šscaleFactor=______, minNeighbors=______

---

## ğŸš€ å»¶ä¼¸æŒ‘æˆ°ï¼ˆé¸åšï¼‰

### æŒ‘æˆ° 1ï¼šä½¿ç”¨ä¸åŒé¡è‰²æ¨™ç¤ºä¸åŒäººè‡‰

```python
# å®šç¾©é¡è‰²åˆ—è¡¨ï¼ˆBGR æ ¼å¼ï¼‰
colors = [
    (0, 255, 0),    # ç¶ è‰²
    (255, 0, 0),    # è—è‰²
    (0, 0, 255),    # ç´…è‰²
    (255, 255, 0),  # é’è‰²
    (255, 0, 255),  # æ´‹ç´…è‰²
    (0, 255, 255),  # é»ƒè‰²
]

for i, (x, y, w, h) in enumerate(faces):
    # å¾ªç’°ä½¿ç”¨é¡è‰²
    color = colors[i % len(colors)]

    # ç¹ªè£½å½©è‰²æ¡†ç·š
    cv2.rectangle(img, (x, y), (x+w, y+h), color, 2)

    # ä½¿ç”¨ç›¸åŒé¡è‰²ç¹ªè£½æ–‡å­—
    label = f"äººè‡‰ {i+1}"
    cv2.putText(img, label, (x, y-10),
                cv2.FONT_HERSHEY_SIMPLEX, 0.9, color, 2)
```

### æŒ‘æˆ° 2ï¼šé¡¯ç¤ºäººè‡‰å¤§å°è³‡è¨Š

```python
for i, (x, y, w, h) in enumerate(faces, start=1):
    cv2.rectangle(img, (x, y), (x+w, y+h), (0, 255, 0), 2)

    # è¨ˆç®—é¢ç©
    area = w * h
    label = f"Face {i}: {w}x{h} ({area}px)"

    cv2.putText(img, label, (x, y-10),
                cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 255, 0), 2)
```

### æŒ‘æˆ° 3ï¼šæ¨™ç¤ºæœ€å¤§å’Œæœ€å°çš„äººè‡‰

```python
if len(faces) > 0:
    # è¨ˆç®—æ¯å¼µäººè‡‰çš„é¢ç©
    face_areas = [(i, x, y, w, h, w*h) for i, (x, y, w, h) in enumerate(faces, start=1)]

    # æ‰¾å‡ºæœ€å¤§å’Œæœ€å°
    largest = max(face_areas, key=lambda x: x[5])
    smallest = min(face_areas, key=lambda x: x[5])

    # æ¨™ç¤ºæœ€å¤§äººè‡‰
    i, x, y, w, h, area = largest
    cv2.rectangle(img, (x, y), (x+w, y+h), (0, 0, 255), 3)  # ç´…è‰²ç²—æ¡†
    cv2.putText(img, "LARGEST", (x, y-30),
                cv2.FONT_HERSHEY_SIMPLEX, 1.0, (0, 0, 255), 2)

    # æ¨™ç¤ºæœ€å°äººè‡‰
    i, x, y, w, h, area = smallest
    cv2.rectangle(img, (x, y), (x+w, y+h), (255, 0, 0), 3)  # è—è‰²ç²—æ¡†
    cv2.putText(img, "SMALLEST", (x, y-30),
                cv2.FONT_HERSHEY_SIMPLEX, 1.0, (255, 0, 0), 2)
```

---

## ğŸ”§ é™¤éŒ¯æŠ€å·§

### å•é¡Œ 1ï¼šç„¡æ³•è®€å–åœ–ç‰‡

**ç—‡ç‹€**ï¼š`img is None` éŒ¯èª¤

**è§£æ±ºæ–¹æ³•**ï¼š
```python
import os

# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
if os.path.exists('girl.jpg'):
    print("âœ“ æª”æ¡ˆå­˜åœ¨")
else:
    print("âœ— æª”æ¡ˆä¸å­˜åœ¨")
    # åˆ—å‡ºç•¶å‰ç›®éŒ„çš„æ‰€æœ‰æª”æ¡ˆ
    print("ç•¶å‰ç›®éŒ„çš„æª”æ¡ˆï¼š")
    for f in os.listdir('.'):
        print(f"  - {f}")
```

### å•é¡Œ 2ï¼šæ¨¡å‹è¼‰å…¥å¤±æ•—

**ç—‡ç‹€**ï¼š`face_cascade.empty()` è¿”å› `True`

**è§£æ±ºæ–¹æ³•**ï¼š
```python
import os

# æª¢æŸ¥æ¨¡å‹æª”æ¡ˆ
model_file = 'haarcascade_frontalface_default.xml'

if not os.path.exists(model_file):
    print(f"æ¨¡å‹æª”æ¡ˆä¸å­˜åœ¨ï¼Œæ­£åœ¨ä¸‹è¼‰...")
    import urllib.request
    url = 'https://raw.githubusercontent.com/opencv/opencv/4.x/data/haarcascades/haarcascade_frontalface_default.xml'
    urllib.request.urlretrieve(url, model_file)
    print("âœ“ ä¸‹è¼‰å®Œæˆ")
```

### å•é¡Œ 3ï¼šåµæ¸¬ä¸åˆ°äººè‡‰

**è¨ºæ–·å·¥å…·**ï¼š
```python
# é¡¯ç¤ºç°éšåœ–ç‰‡ï¼Œæª¢æŸ¥å“è³ª
print("ç°éšåœ–ç‰‡ï¼š")
cv2_imshow(gray)

# å˜—è©¦ä¸åŒåƒæ•¸çµ„åˆ
param_combinations = [
    (1.05, 3),
    (1.1, 3),
    (1.1, 5),
    (1.2, 5),
]

print("\nåƒæ•¸æ¸¬è©¦ï¼š")
for sf, mn in param_combinations:
    faces = face_cascade.detectMultiScale(gray, scaleFactor=sf, minNeighbors=mn)
    print(f"scaleFactor={sf}, minNeighbors={mn}: {len(faces)} å¼µäººè‡‰")
```

### å•é¡Œ 4ï¼šä¸­æ–‡æ¨™ç±¤é¡¯ç¤ºç‚ºäº‚ç¢¼æˆ–æ–¹æ¡†

**åŸå› **ï¼šOpenCV é è¨­ä¸æ”¯æ´ä¸­æ–‡å­—é«”

**è§£æ±ºæ–¹æ³•**ï¼š
```python
# æ–¹æ³• 1ï¼šä½¿ç”¨è‹±æ–‡æ¨™ç±¤
label = f"Face {i}"  # ä¸ä½¿ç”¨ä¸­æ–‡

# æ–¹æ³• 2ï¼šä½¿ç”¨ PIL ç¹ªè£½ä¸­æ–‡ï¼ˆé€²éšï¼‰
from PIL import Image, ImageDraw, ImageFont

# å°‡ OpenCV åœ–ç‰‡è½‰ç‚º PIL æ ¼å¼
pil_img = Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
draw = ImageDraw.Draw(pil_img)

# è¼‰å…¥ä¸­æ–‡å­—é«”ï¼ˆéœ€è¦ä¸Šå‚³å­—é«”æª”ï¼‰
# font = ImageFont.truetype("NotoSansTC-Regular.ttf", 30)
# draw.text((x, y-40), f"äººè‡‰ {i}", font=font, fill=(0, 255, 0))

# è½‰å› OpenCV æ ¼å¼
img = cv2.cvtColor(np.array(pil_img), cv2.COLOR_RGB2BGR)
```

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ FAQ

### Q1: ç‚ºä»€éº¼åµæ¸¬åˆ°çš„äººè‡‰æ•¸é‡ä¸æ­£ç¢ºï¼Ÿ

**A:** å¯èƒ½åŸå› ï¼š
1. **äººè‡‰è§’åº¦å•é¡Œ**ï¼šHaar Cascade å°æ­£é¢è‡‰æ•ˆæœæœ€å¥½
2. **å…‰ç·šå•é¡Œ**ï¼šå¤ªæš—æˆ–éæ›æœƒå½±éŸ¿åµæ¸¬
3. **äººè‡‰å¤§å°**ï¼šéå°ï¼ˆ< 30Ã—30pxï¼‰æœƒè¢«å¿½ç•¥
4. **åƒæ•¸è¨­å®š**ï¼š`minNeighbors` éé«˜æœƒæ¼æ‰çœŸå¯¦äººè‡‰

**å»ºè­°èª¿æ•´**ï¼š
- é™ä½ `scaleFactor`ï¼š1.1 â†’ 1.05
- é™ä½ `minNeighbors`ï¼š5 â†’ 3
- é™ä½ `minSize`ï¼š(30,30) â†’ (20,20)

### Q2: å¦‚ä½•ä¸Šå‚³è‡ªå·±çš„ç…§ç‰‡åˆ° Colabï¼Ÿ

**A:** ä½¿ç”¨ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
```python
from google.colab import files

# ä¸Šå‚³æª”æ¡ˆ
print("è«‹é¸æ“‡è¦ä¸Šå‚³çš„åœ–ç‰‡ï¼š")
uploaded = files.upload()

# åˆ—å‡ºä¸Šå‚³çš„æª”æ¡ˆ
for filename in uploaded.keys():
    print(f"å·²ä¸Šå‚³: {filename}")

# è®€å–ä¸Šå‚³çš„åœ–ç‰‡
img = cv2.imread(filename)
```

### Q3: å¯ä»¥ä¸€æ¬¡è™•ç†å¤šå¼µåœ–ç‰‡å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œä½¿ç”¨è¿´åœˆè™•ç†ï¼š
```python
# åœ–ç‰‡åˆ—è¡¨
image_files = ['photo1.jpg', 'photo2.jpg', 'photo3.jpg']

for img_file in image_files:
    print(f"\nè™•ç†åœ–ç‰‡: {img_file}")
    img = cv2.imread(img_file)

    if img is None:
        print(f"  ç„¡æ³•è®€å– {img_file}")
        continue

    # åŸ·è¡Œåµæ¸¬ï¼ˆèˆ‡åŸç¨‹å¼ç¢¼ç›¸åŒï¼‰
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    faces = face_cascade.detectMultiScale(gray, 1.1, 5)

    print(f"  åµæ¸¬åˆ° {len(faces)} å¼µäººè‡‰")

    # ç¹ªè£½çµæœä¸¦å„²å­˜
    for i, (x, y, w, h) in enumerate(faces, start=1):
        cv2.rectangle(img, (x, y), (x+w, y+h), (0, 255, 0), 2)

    output_file = f"result_{img_file}"
    cv2.imwrite(output_file, img)
    print(f"  çµæœå·²å„²å­˜ç‚º {output_file}")
```

### Q4: å¦‚ä½•æé«˜åµæ¸¬æº–ç¢ºç‡ï¼Ÿ

**A:** å¯¦ç”¨æŠ€å·§ï¼š
1. **å½±åƒé è™•ç†**ï¼š
   ```python
   # èª¿æ•´å°æ¯”åº¦å’Œäº®åº¦
   img = cv2.convertScaleAbs(img, alpha=1.2, beta=20)

   # å»é™¤é›œè¨Š
   img = cv2.GaussianBlur(img, (5, 5), 0)
   ```

2. **å¤šå°ºåº¦åµæ¸¬**ï¼š
   ```python
   # ä½¿ç”¨æ›´å°çš„ scaleFactor
   faces = face_cascade.detectMultiScale(
       gray,
       scaleFactor=1.05,  # æ›´ç²¾ç´°çš„æƒæ
       minNeighbors=3,
       minSize=(20, 20)
   )
   ```

3. **å¾Œè™•ç†éæ¿¾**ï¼š
   ```python
   # éæ¿¾é¢ç©éå°çš„åµæ¸¬æ¡†
   valid_faces = []
   for (x, y, w, h) in faces:
       area = w * h
       if area > 1000:  # åªä¿ç•™é¢ç© > 1000 çš„äººè‡‰
           valid_faces.append((x, y, w, h))
   ```

### Q5: ç¨‹å¼åŸ·è¡Œå¾ˆæ…¢æ€éº¼è¾¦ï¼Ÿ

**A:** å„ªåŒ–æŠ€å·§ï¼š
1. **ç¸®å°åœ–ç‰‡**ï¼š
   ```python
   # ç¸®å°åˆ°åŸä¾†çš„ 50%
   img = cv2.resize(img, (0, 0), fx=0.5, fy=0.5)
   ```

2. **æé«˜ scaleFactor**ï¼š
   ```python
   # ä½¿ç”¨è¼ƒå¤§çš„ scaleFactor åŠ å¿«é€Ÿåº¦
   faces = face_cascade.detectMultiScale(gray, 1.3, 5)
   ```

3. **é™åˆ¶åµæ¸¬å€åŸŸ**ï¼ˆå¦‚æœçŸ¥é“äººè‡‰å¤§æ¦‚ä½ç½®ï¼‰ï¼š
   ```python
   # åªåµæ¸¬åœ–ç‰‡ä¸­å¤®å€åŸŸ
   h, w = gray.shape
   roi = gray[h//4:3*h//4, w//4:3*w//4]
   faces = face_cascade.detectMultiScale(roi, 1.1, 5)

   # è¨˜å¾—å°‡åº§æ¨™è½‰æ›å›åŸåœ–
   for (x, y, w, h) in faces:
       actual_x = x + w//4
       actual_y = y + h//4
       # ...
   ```

---

## ğŸ“Š è©•åˆ†æ¨™æº–

| é …ç›® | é…åˆ† | è©•åˆ†é‡é» |
|------|------|----------|
| **åŠŸèƒ½å®Œæ•´æ€§** | 40% | æ‰€æœ‰ 9 å€‹éœ€æ±‚éƒ½å·²å¯¦ä½œä¸¦æ­£å¸¸é‹ä½œ |
| **ç¨‹å¼ç¢¼å“è³ª** | 25% | çµæ§‹æ¸…æ™°ã€è¨»è§£å®Œæ•´ã€è®Šæ•¸å‘½åè¦ç¯„ |
| **åŸ·è¡Œçµæœ** | 20% | èƒ½æ­£ç¢ºåµæ¸¬äººè‡‰ä¸¦é¡¯ç¤ºç·¨è™Ÿ |
| **æ¸¬è©¦å ±å‘Š** | 10% | å®Œæ•´è¨˜éŒ„æ¸¬è©¦éç¨‹èˆ‡å¿ƒå¾—åæ€ |
| **å»¶ä¼¸æŒ‘æˆ°** | 5% | å®Œæˆè‡³å°‘ä¸€é …å»¶ä¼¸æŒ‘æˆ°ï¼ˆåŠ åˆ†é …ï¼‰ |

---

## ğŸ“š å­¸ç¿’è³‡æº

### åƒè€ƒæ–‡ä»¶
- ä¸»è¦æ•™å­¸ï¼š`opencv_imageclassfy_b05.md`
- OpenCV å®˜æ–¹ï¼š[Cascade Classifier Tutorial](https://docs.opencv.org/4.x/db/d28/tutorial_cascade_classifier.html)

### ç›¸é—œå‡½æ•¸èªªæ˜
- `cv2.imread()`ï¼šè®€å–åœ–ç‰‡
- `cv2.cvtColor()`ï¼šè½‰æ›è‰²å½©ç©ºé–“
- `cv2.CascadeClassifier()`ï¼šè¼‰å…¥åˆ†é¡å™¨
- `detectMultiScale()`ï¼šå¤šå°ºåº¦åµæ¸¬
- `cv2.rectangle()`ï¼šç¹ªè£½çŸ©å½¢
- `cv2.putText()`ï¼šç¹ªè£½æ–‡å­—

---

**ç¥å­¸ç¿’é †åˆ©ï¼å®Œæˆå¾Œè¨˜å¾—æ¸¬è©¦ä¸åŒçš„å½±åƒï¼Œè§€å¯Ÿåƒæ•¸å°çµæœçš„å½±éŸ¿ã€‚** ğŸ“
